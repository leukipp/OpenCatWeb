!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i;i="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,i.nipplejs=t()}}(function(){function t(t,i){return this.handlers={},this.identifier=i.identifier,this.position=i.position,this.frontPosition=i.frontPosition,this.manager=t,this.config(i),this.buildEl().stylize(),this.toReturn={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,options:this.options},this.toReturn}function i(t){var i=this;if(i.handlers={},i.pressureIntervals={},i.config(t),i.box=this.options.zone.getBoundingClientRect(),i.nipples=[],i.bindEvt(i.options.zone,"start"),i.on("destroyed",this.ondestroyed),i.nipples.on=i.on.bind(i),i.nipples.off=i.off.bind(i),i.nipples.options=i.options,i.nipples.nippleOptions=i.nippleOptions,i.nipples.destroy=i.destroy.bind(i),i.nipples.get=function(t){for(var e=0,o=i.nipples.length;o>e;e+=1)if(i.nipples[e].identifier===t)return i.nipples[e]},"static"===i.options.mode){var e=this.createNipple(this.options.position,0);e.add()}var o;return window.onresize=function(t){clearTimeout(o),o=setTimeout(function(){var t,e=h.getScroll();i.nipples.forEach(function(i){t=i.el.getBoundingClientRect(),i.position={x:e.x+t.left,y:e.y+t.top}})},100)},i.nipples}var e,o=!!("ontouchstart"in window),n=window.PointerEvent?!0:!1,s=window.MSPointerEvent?!0:!1,r={touch:{start:"touchstart",move:"touchmove",end:"touchend"},mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup"},MSPointer:{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}},p={},a={};n?e=r.pointer:s?e=r.MSPointer:o?(e=r.touch,a=r.mouse):e=r.mouse;var h={};h.distance=function(t,i){var e=i.x-t.x,o=i.y-t.y;return Math.sqrt(e*e+o*o)},h.angle=function(t,i){var e=i.x-t.x,o=i.y-t.y;return h.degrees(Math.atan2(o,e))},h.findCoord=function(t,i,e){var o={x:0,y:0};return e=h.radians(e),o.x=t.x-i*Math.cos(e),o.y=t.y-i*Math.sin(e),o},h.radians=function(t){return t*(Math.PI/180)},h.degrees=function(t){return t*(180/Math.PI)},h.bindEvt=function(t,i,e){t.addEventListener?t.addEventListener(i,e,!1):t.attachEvent&&t.attachEvent(i,e)},h.unbindEvt=function(t,i,e){t.removeEventListener?t.removeEventListener(i,e):t.detachEvent&&t.detachEvent(i,e)},h.trigger=function(t,i,e){var o=new CustomEvent(i,e);t.dispatchEvent(o)},h.prepareEvent=function(t){return t.preventDefault(),t.type.match(/^touch/)?t.changedTouches:t},h.getScroll=function(){var t=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,i=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return{x:t,y:i}},h.applyPosition=function(t,i){i.x&&i.y?(t.style.left=i.x+"px",t.style.top=i.y+"px"):(i.top||i.right||i.bottom||i.left)&&(t.style.top=i.top,t.style.right=i.right,t.style.bottom=i.bottom,t.style.left=i.left)},h.getTransitionStyle=function(t,i,e){var o=h.configStylePropertyObject(t);for(var n in o)if(o.hasOwnProperty(n))if("string"==typeof i)o[n]=i+" "+e;else{for(var s="",r=0,p=i.length;p>r;r+=1)s+=i[r]+" "+e+", ";o[n]=s.slice(0,-2)}return o},h.getVendorStyle=function(t,i){var e=h.configStylePropertyObject(t);for(var o in e)e.hasOwnProperty(o)&&(e[o]=i);return e},h.configStylePropertyObject=function(t){var i={};i[t]="";var e=["webkit","Moz","o"];return e.forEach(function(e){i[e+t.charAt(0).toUpperCase()+t.slice(1)]=""}),i},h.extend=function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};var d=function(){};return d.prototype.on=function(t,i){for(var e,o=this,n=t.split(/[ ,]+/g),s=0;s<n.length;s+=1)e=n[s],o.handlers[e]=o.handlers[e]||[],o.handlers[e].push(i);return o},d.prototype.off=function(t,i){var e=this;return void 0===t?e.handlers={}:void 0===i?e.handlers[t]=null:e.handlers[t]&&e.handlers[t].indexOf(i)>=0&&e.handlers[t].splice(e.handlers[t].indexOf(i),1),e},d.prototype.trigger=function(t,i){for(var e,o=this,n=t.split(/[ ,]+/g),s=0;s<n.length;s+=1)e=n[s],o.handlers[e]&&o.handlers[e].length&&o.handlers[e].forEach(function(t){t.call(o,{type:e,target:o},i)})},t.prototype=new d,t.constructor=t,t.prototype.config=function(t){this.options={},this.options.size=100,this.options.threshold=.1,this.options.color="white",this.options.fadeTime=250,this.options.dataOnly=!1,this.options.restOpacity=.5,this.options.mode="dynamic";for(var i in t)this.options.hasOwnProperty(i)&&(this.options[i]=t[i]);return"dynamic"===this.options.mode&&(this.options.restOpacity=0),this},t.prototype.buildEl=function(t){return this.options.dataOnly?void 0:(this.ui={},this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple",this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.identifier),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front),this)},t.prototype.stylize=function(){if(!this.options.dataOnly){var t=this.options.fadeTime+"ms",i=h.getVendorStyle("borderRadius","50%"),e=h.getTransitionStyle("transition","opacity",t),o={};return o.el={width:this.options.size+"px",height:this.options.size+"px",position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},o.back={position:"absolute",display:"block",width:"100%",height:"100%",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},o.front={width:"50%",height:"50%",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5"},h.extend(o.el,e),h.extend(o.back,i),h.extend(o.front,i),this.applyStyles(o),this}},t.prototype.applyStyles=function(t){for(var i in this.ui)if(this.ui.hasOwnProperty(i))for(var e in t[i])this.ui[i].style[e]=t[i][e];return this},t.prototype.addToDom=function(){return this.options.dataOnly||document.contains(this.ui.el)?void 0:(this.manager.options.zone.appendChild(this.ui.el),this)},t.prototype.removeFromDom=function(){return!this.options.dataOnly&&document.contains(this.ui.el)?(this.manager.options.zone.removeChild(this.ui.el),this):void 0},t.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.off(),this.removeFromDom(),this.trigger("destroyed",this.toReturn),this.manager.trigger("destroyed "+this.identifier+":destroyed",this.toReturn)},t.prototype.show=function(t){var i=this;if(!i.options.dataOnly)return clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.addToDom(),i.restCallback(),setTimeout(function(){i.ui.el.style.opacity=1},0),i.showTimeout=setTimeout(function(){i.trigger("shown",i.toReturn),i.manager.trigger("shown "+i.identifier+":shown",i.toReturn),"function"==typeof t&&t.call(this)},i.options.fadeTime),i},t.prototype.hide=function(t){var i=this;if(!i.options.dataOnly)return i.ui.el.style.opacity=i.options.restOpacity,clearTimeout(i.removeTimeout),clearTimeout(i.showTimeout),clearTimeout(i.restTimeout),i.removeTimeout=setTimeout(function(){var e="dynamic"===i.options.mode?"none":"block";i.ui.el.style.display=e,"function"==typeof t&&t.call(i),i.trigger("hidden",i.toReturn),i.manager.trigger("hidden "+i.identifier+":hidden",i.toReturn)},i.options.fadeTime),i.restPosition(),i},t.prototype.restPosition=function(t){var i=this;i.frontPosition={x:0,y:0};var e=i.options.fadeTime+"ms",o={};o.front=h.getTransitionStyle("transition",["top","left"],e);var n={front:{}};n.front={left:i.frontPosition.x+"px",top:i.frontPosition.y+"px"},i.applyStyles(o),i.applyStyles(n),i.restTimeout=setTimeout(function(){"function"==typeof t&&t.call(i),i.restCallback()},i.options.fadeTime)},t.prototype.restCallback=function(){var t=this,i={};i.front=h.getTransitionStyle("transition","none",""),t.applyStyles(i),t.trigger("rested",t.toReturn),t.manager.trigger("rested "+t.identifier+":rested",t.toReturn)},t.prototype.computeDirection=function(t){var i,e,o,n=t.angle.radian,s=Math.PI/4,r=Math.PI/2;if(i=n>s&&3*s>n?"up":n>-s&&s>=n?"left":n>3*-s&&-s>=n?"down":"right",e=n>-r&&r>n?"left":"right",o=n>0?"up":"down",t.force>this.options.threshold){var p={};for(var a in this.direction)this.direction.hasOwnProperty(a)&&(p[a]=this.direction[a]);var h=!0;this.direction={x:e,y:o,angle:i},t.direction=this.direction;for(var a in p)p[a]!==this.direction[a]&&(h=!1);if(h)return t;(p.x!==this.direction.x||p.y!==this.direction.y)&&(this.trigger("plain",t),this.manager.trigger("plain "+this.identifier+":plain",t)),p.x!==this.direction.x&&(this.trigger("plain:"+e,t),this.manager.trigger("plain:"+e+" "+this.identifier+":plain:"+e,t)),p.y!==this.direction.y&&(this.trigger("plain:"+o,t),this.manager.trigger("plain:"+o+" "+this.identifier+":plain:"+o,t)),p.angle!==this.direction.angle&&(this.trigger("dir dir:"+i,t),this.manager.trigger("dir dir:"+i+" "+this.identifier+":dir "+this.identifier+":dir:"+i,t))}return t},i.prototype=new d,i.constructor=i,i.prototype.config=function(t){this.options={},this.nippleOptions={},this.options.zone=document.body,this.options.multitouch=!1,this.options.maxNumberOfNipples=1,this.options.mode="dynamic",this.options.position={top:0,left:0},this.options.catchDistance=200,this.nippleOptions.size=100,this.nippleOptions.threshold=.1,this.nippleOptions.color="white",this.nippleOptions.fadeTime=250,this.nippleOptions.dataOnly=!1,this.nippleOptions.restOpacity=.5,this.nippleOptions.mode=this.options.mode;for(var i in t)this.options.hasOwnProperty(i)?this.options[i]=t[i]:this.nippleOptions.hasOwnProperty(i)&&(this.nippleOptions[i]=t[i]);return("static"===this.options.mode||"semi"===this.options.mode)&&(this.options.multitouch=!1,this.options.maxNumberOfNipples=1),this},i.prototype.createNipple=function(i,e){var o=h.getScroll(),n={};if(i.x&&i.y)n={x:i.x-(o.x+this.box.left),y:i.y-(o.y+this.box.top)};else if(i.top||i.right||i.bottom||i.left){var s=document.createElement("DIV");s.style.display="hidden",s.style.top=i.top,s.style.right=i.right,s.style.bottom=i.bottom,s.style.left=i.left,s.style.position="absolute",this.options.zone.appendChild(s);var r=s.getBoundingClientRect();this.options.zone.removeChild(s),n=i,i={x:r.left+o.x,y:r.top+o.y}}var p={x:0,y:0},a=new t(this,{color:this.nippleOptions.color,size:this.nippleOptions.size,threshold:this.nippleOptions.threshold,fadeTime:this.nippleOptions.fadeTime,dataOnly:this.nippleOptions.dataOnly,restOpacity:this.nippleOptions.restOpacity,mode:this.options.mode,identifier:e,position:i,frontPosition:p});return this.nippleOptions.dataOnly||(h.applyPosition(a.ui.el,n),h.applyPosition(a.ui.front,a.frontPosition)),this.nipples.push(a),a},i.prototype.bindEvt=function(t,i){var o=this;return p[i]=function(){o["on"+i].apply(o,arguments)},h.bindEvt(t,e[i],p[i]),a[i]&&h.bindEvt(t,a[i],p[i]),o},i.prototype.unbindEvt=function(t,i){return h.unbindEvt(t,e[i],p[i]),a[i]&&h.unbindEvt(t,a[i],p[i]),p[i]=void 0,this},i.prototype.onstart=function(t){if(t=h.prepareEvent(t),this.box=this.options.zone.getBoundingClientRect(),this.scroll=h.getScroll(),t.length&&this.options.multitouch&&this.nipples.length<this.options.maxNumberOfNipples)for(var i=0,e=t.length;e>i;i+=1)this.processOnStart(t[i]);else(0===this.nipples.length||"dynamic"!==this.options.mode)&&this.processOnStart(t[0]||t);return this.started||(this.bindEvt(document,"move").bindEvt(document,"end"),this.started=!0),!1},i.prototype.pressureFn=function(t,i,e){var o=0;clearInterval(this.pressureIntervals[e]),this.pressureIntervals[e]=setInterval(function(){var e=t.force||t.pressure||t.webkitForce||0;e!==o&&(i.trigger("pressure",e),this.trigger("pressure "+i.identifier+":pressure",e),o=e)}.bind(this),100)},i.prototype.processOnStart=function(t){var i=(void 0!==t.identifier?t.identifier:t.pointerId)||0,e=t.force||t.pressure||t.webkitForce||0,o=this.nipples.get(i),n={x:t.pageX,y:t.pageY};if(o){if("static"===this.options.mode&&(o.show(),e>0&&this.pressureFn(t,o,i),this.processOnMove(t)),"semi"===this.options.mode){var s=h.distance(n,o.position);s<=this.options.catchDistance?(o.show(),e>0&&this.pressureFn(t,o,i),this.processOnMove(t)):(o.destroy(),this.processOnStart(t))}}else o=this.createNipple(n,i),this.trigger("added "+o.identifier+":added",o),o.show(),e>0&&this.pressureFn(t,o,i);return o.trigger("start",o),this.trigger("start "+o.identifier+":start",o),o},i.prototype.onmove=function(t){t=h.prepareEvent(t);var i=[];if(t.length&&this.options.multitouch)for(var e=0,o=t.length;o>e;e+=1)i.push(this.processOnMove(t[e]));else i.push(this.processOnMove(t[0]||t));return!1},i.prototype.processOnMove=function(t){var i=(void 0!==t.identifier?t.identifier:t.pointerId)||0,e=this.nipples.get(i);if(!e)return console.error("MOVE: Couldn't find the nipple n°"+i+"."),void console.error(this.nipples);var o=e.options.size/2,n={x:t.pageX,y:t.pageY},s=h.distance(n,e.position),r=h.angle(n,e.position),p=h.radians(r),a=s/o;s>o&&(s=o,n=h.findCoord(e.position,s,r)),e.frontPosition={x:n.x-e.position.x,y:n.y-e.position.y},this.nippleOptions.dataOnly||h.applyPosition(e.ui.front,e.frontPosition);var d={identifier:e.identifier,position:n,force:a,pressure:t.force||t.pressure||t.webkitForce||0,distance:s,angle:{radian:p,degree:r},instance:e};return d=e.computeDirection(d),d.angle={radian:h.radians(180-r),degree:180-r},e.trigger("move",d),this.trigger("move "+i+":move",d),d},i.prototype.onend=function(t){if(t=h.prepareEvent(t),t.length&&this.options.multitouch)for(var i=0,e=t.length;e>i;i+=1)this.processOnEnd(t[i]);else this.processOnEnd(t[0]||t);return this.nipples.length&&"dynamic"===this.options.mode||(this.unbindEvt(document,"move").unbindEvt(document,"end"),this.started=!1),!1},i.prototype.processOnEnd=function(t){var i=(void 0!==t.identifier?t.identifier:t.pointerId)||0,e=this,o=e.nipples.get(i);return o?(this.nippleOptions.dataOnly||o.hide(function(){"dynamic"===e.options.mode&&(o.trigger("removed",o),e.trigger("removed "+i+":removed",o),o.destroy())}),clearInterval(e.pressureIntervals[i]),o.trigger("end",o),e.trigger("end "+i+":end",o),void("dynamic"===this.options.mode&&this.nipples.splice(this.nipples.indexOf(o),1))):(console.error("END: Couldn't find the nipple n°"+i+"."),void console.error(e.nipples))},i.prototype.ondestroyed=function(t,i){return this.nipples.indexOf(i)<0?!1:void this.nipples.splice(this.nipples.indexOf(i),1)},i.prototype.destroy=function(){this.unbindEvt(this.options.zone,"start"),this.unbindEvt(document,"move"),this.unbindEvt(document,"end"),this.nipples.forEach(function(t){t.destroy()});for(var t in this.pressureIntervals)this.pressureIntervals.hasOwnProperty(t)&&clearInterval(this.pressureIntervals[t]);this.off()},{create:function(t){return new i(t)}}});